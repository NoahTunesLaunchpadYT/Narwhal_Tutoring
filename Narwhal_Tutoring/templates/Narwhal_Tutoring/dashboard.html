{% extends "Narwhal_Tutoring/layout.html" %}
{% load static %}

{% block body %}
<a class="navbar-brand" href="{% url 'index'%}"><img src="{% static 'images/text_logo.png' %}" alt="Example Image" class="logo"></a>
    <section class="section-p1">
        <h1 class="center-title">
            Dashboard
        </h1>
    </section>
    <section id="dashboard-panel">
        <div class="dashboard-nav">
            <div class="col-12">
              <div class="list-group" id="list-tab" role="tablist">
                <a class="list-group-item list-group-item-action active" id="list-profile-list" data-toggle="list" href="#list-profile" role="tab" aria-controls="profile">Profile</a>
                <a class="list-group-item list-group-item-action" id="list-schedule-list" data-toggle="list" href="#list-schedule" role="tab" aria-controls="schedule">Schedule</a>
                <a class="list-group-item list-group-item-action" id="list-log-list" data-toggle="list" href="#list-log" role="tab" aria-controls="log">Lesson Log</a>
                <a class="list-group-item list-group-item-action" id="list-settings-list" data-toggle="list" href="#list-settings" role="tab" aria-controls="settings">Settings</a>
              </div>
            </div>
        </div>
        {% if messages %}
        <div class="container mt-3">
            {% for message in messages %}
            <div class="alert {% if message.tags %} alert-{{ message.tags }}{% endif %}" role="alert">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        <div class="row dashboard-content">
            <div class="col-12">
              <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">
                    <h3>Profile</h3>
                    <form action="{% url 'dashboard' %}#list-profile" method="post">
                        {% csrf_token %}

                        <p>Hit the "Submit" button at the bottom to save changes</p>

                        {% if user.tutor %}
                            <!-- Available -->
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="available" name="available" {% if user.available %}checked{% endif %}>
                                <label class="form-check-label" for="available">Available</label>
                            </div>
                            <p>
                                (Only tutors who are "available" can gain new clients.)
                            </p>
                        {% endif %}
                    
                    
                        <!-- Username -->
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" required>
                        </div>
                        
                        <!-- Email -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email*</label>
                            <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                        </div>
                    
                        <!-- Mobile Number -->
                        <div class="mb-3">
                            <label for="mobile" class="form-label">Mobile</label>
                            <input type="tel" class="form-control" id="mobile" name="mobile" pattern="[0-9]{10}" placeholder="e.g., 0455555555" value="{{ user.mobile }}" required>
                            <small class="form-text text-muted">Please enter your mobile number (10 digits).</small>
                        </div>

                        {% if user.tutor %}
                            <!-- ATAR -->
                            <div class="mb-3">
                                <label for="atar" class="form-label">ATAR</label>
                                <input type="number" class="form-control" id="atar" name="atar" step="0.01" value="{{ user.atar }}" required>
                            </div>
                            
                            <!-- Suburb -->
                            <div class="mb-3">
                                <label for="suburb" class="form-label">Suburb</label>
                                <input type="text" class="form-control" id="suburb" name="suburb" value="{{ user.suburb }}" required>
                            </div>

                            <!-- Subjects (Multiselect) -->
                            <div class="form-group">
                                <label>Subjects (check to select multiple)</label>
                                {% for subject in subjects %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="subject_{{ subject.id }}" name="subjects" value="{{ subject.id }}" {% if subject in user.subjects.all %}checked{% endif %}>
                                        <label class="form-check-label" for="subject_{{ subject.id }}">{{ subject.name }}</label>
                                    </div>
                                {% endfor %}
                            </div>  
                            
                            <!-- Description -->
                            <div class="mb-3">
                                <label for="description" class="form-label">Description</label>
                                <textarea class="form-control" id="description" name="description" rows="5" maxlength="1000" required>{{ user.description }}</textarea>
                            </div>
                            
                            <!-- University (Optional) -->
                            <div class="mb-3">
                                <label for="university" class="form-label">University (optional)</label>
                                <input type="text" class="form-control" id="university" name="university" value="{{ user.university }}">
                            </div>
                            
                            <!-- Degree (Optional) -->
                            <div class="mb-3">
                                <label for="degree" class="form-label">Degree (optional)</label>
                                <input type="text" class="form-control" id="degree" name="degree" value="{{ user.degree }}">
                            </div>
                        {% else %}
                            <!-- Address -->
                            <div class="mb-3">
                                <label for="address" class="form-label">Address</label>
                                <input type="text" class="form-control" id="address" name="address" value="{{ user.address }}">
                            </div>

                            <!-- Student 1 -->
                            <div class="mb-3">
                                <label for="student1_name" class="form-label">Student 1 name</label>
                                <input type="text" class="form-control" id="student1_name" name="student1_name" value="{{ user.student1_name }}">
                            </div>

                            <!-- Student 2 -->
                            <div class="mb-3">
                                <label for="student2_name" class="form-label">Student 2 name</label>
                                <input type="text" class="form-control" id="student2_name" name="student2_name" value="{{ user.student2_name }}">
                            </div>

                            <!-- Student 3 -->
                            <div class="mb-3">
                                <label for="student3_name" class="form-label">Student 3 name</label>
                                <input type="text" class="form-control" id="student3_name" name="student3_name" value="{{ user.student3_name }}">
                            </div>
                        {% endif %}
                        
                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>                                             
                </div>
                <div class="tab-pane fade" id="list-schedule" role="tabpanel" aria-labelledby="list-schedule-list">
                    {% if user.tutor %}
                        <h3>Semester 1 availabilities</h3>
                        {% if user.available %}
                            You are listed as <strong>available</strong>.
                            <form action="{% url 'submit-timetable' %}#list-schedule" method="post">
                                <div class="timetable">
                                    {% csrf_token %}
                                    <div class="column">
                                        <h6 class="day-header">times</h6>
                                        {% for time in times %}
                                            <p class="timetable-time">{{ time }}</p>
                                        {% endfor %}
                                    </div>
                                                            
                                    <!-- Monday -->
                                    <div class="column">
                                        <h6 class="day-header">Mon</h6>
                                        {% for time in times %}
                                            {% if time in user.availability.monday_times.all %}
                                                <div class="dashboard-timetable-cell selected">
                                                    <input type="hidden" class="timeslot" name="monday-{{ time }}" value="true">
                                                </div>
                                            {% else %}
                                                <div class="dashboard-timetable-cell">
                                                    <input type="hidden" class="timeslot" name="monday-{{ time }}" value="false">
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
    
                                    <!-- Tuesday -->
                                    <div class="column">
                                        <h6 class="day-header">Tue</h6>
                                        {% for time in times %}
                                            {% if time in user.availability.tuesday_times.all %}
                                                <div class="dashboard-timetable-cell selected">
                                                    <input type="hidden" class="timeslot" name="tuesday-{{ time }}" value="true">
                                                </div>
                                            {% else %}
                                                <div class="dashboard-timetable-cell">
                                                    <input type="hidden" class="timeslot" name="tuesday-{{ time }}" value="false">
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
    
                                    <!-- Wednesday -->
                                    <div class="column">
                                        <h6 class="day-header">Wed</h6>
                                        {% for time in times %}
                                            {% if time in user.availability.wednesday_times.all %}
                                                <div class="dashboard-timetable-cell selected">
                                                    <input type="hidden" class="timeslot" name="wednesday-{{ time }}" value="true">
                                                </div>
                                            {% else %}
                                                <div class="dashboard-timetable-cell">
                                                    <input type="hidden" class="timeslot" name="wednesday-{{ time }}" value="false">
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
    
                                    <!-- Thursday -->
                                    <div class="column">
                                        <h6 class="day-header">Thu</h6>
                                        {% for time in times %}
                                            {% if time in user.availability.thursday_times.all %}
                                                <div class="dashboard-timetable-cell selected">
                                                    <input type="hidden" class="timeslot" name="thursday-{{ time }}" value="true">
                                                </div>
                                            {% else %}
                                                <div class="dashboard-timetable-cell">
                                                    <input type="hidden" class="timeslot" name="thursday-{{ time }}" value="false">
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
    
                                    <!-- Friday -->
                                    <div class="column">
                                        <h6 class="day-header">Fri</h6>
                                        {% for time in times %}
                                            {% if time in user.availability.friday_times.all %}
                                                <div class="dashboard-timetable-cell selected">
                                                    <input type="hidden" class="timeslot" name="friday-{{ time }}" value="true">
                                                </div>
                                            {% else %}
                                                <div class="dashboard-timetable-cell">
                                                    <input type="hidden" class="timeslot" name="friday-{{ time }}" value="false">
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
    
                                    <!-- Saturday -->
                                    <div class="column">
                                        <h6 class="day-header">Sat</h6>
                                        {% for time in times %}
                                            {% if time in user.availability.saturday_times.all %}
                                                <div class="dashboard-timetable-cell selected">
                                                    <input type="hidden" class="timeslot" name="saturday-{{ time }}" value="true">
                                                </div>
                                            {% else %}
                                                <div class="dashboard-timetable-cell">
                                                    <input type="hidden" class="timeslot" name="saturday-{{ time }}" value="false">
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
    
                                    <!-- Sunday -->
                                    <div class="column">
                                        <h6 class="day-header">Sun</h6>
                                        {% for time in times %}
                                            {% if time in user.availability.sunday_times.all %}
                                                <div class="dashboard-timetable-cell selected">
                                                    <input type="hidden" class="timeslot" name="sunday-{{ time }}" value="true">
                                                </div>
                                            {% else %}
                                                <div class="dashboard-timetable-cell">
                                                    <input type="hidden" class="timeslot" name="sunday-{{ time }}" value="false">
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>                        
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </form>
                        {% else %}
                            You are listed as <strong>unavailable</strong>. Got to profile, check "Available" and hit "Submit" to be listed as available.
                        {% endif %}
                    {% else %}
                        <h3>Schedule</h3>
                    {% endif %}
                </div>
                <div class="tab-pane fade" id="list-log" role="tabpanel" aria-labelledby="list-log-list">
                    <h3>Lesson Log</h3>
                </div>
                <div class="tab-pane fade" id="list-settings" role="tabpanel" aria-labelledby="list-settings-list">
                    <h3>Settings</h3>
                </div>
              </div>
            </div>
          </div>
    </section>
{% endblock %}

{% block script %}
    <script src="{% static 'javascript/dashboard.js' %}"></script>
{% endblock %}