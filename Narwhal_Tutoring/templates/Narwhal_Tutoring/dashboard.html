{% extends "Narwhal_Tutoring/layout.html" %}
{% load static %}

{% block body %}
<a class="navbar-brand" href="{% url 'index'%}"><img src="{% static 'images/text_logo.png' %}" alt="Example Image" class="logo"></a>
    <section class="section-p1">
        <h1 class="center-title">
            Dashboard
            <p>(Dashboard is best used on desktop)</p>
        </h1>
    </section>
    <section id="dashboard-panel">
        {% if message %}
            <div class="alert alert-warning" role="alert">
                {{ message }}
            </div>
        {% endif %}
        <div class="row dashboard-nav">
            <div class="col-12">
              <div class="list-group" id="list-tab" role="tablist">
                <a class="list-group-item list-group-item-action active" id="list-profile-list" data-toggle="list" href="#list-profile" role="tab" aria-controls="profile">Profile</a>
                <a class="list-group-item list-group-item-action" id="list-schedule-list" data-toggle="list" href="#list-schedule" role="tab" aria-controls="schedule">Schedule</a>
                <a class="list-group-item list-group-item-action" id="list-log-list" data-toggle="list" href="#list-log" role="tab" aria-controls="log">Lesson Log</a>
                <a class="list-group-item list-group-item-action" id="list-settings-list" data-toggle="list" href="#list-settings" role="tab" aria-controls="settings">Settings</a>
              </div>
            </div>
        </div>
        <div class="row dashboard-content">
            <div class="col-12">
              <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">
                    <h3>Profile</h3>
                    <form action="{% url 'dashboard' %}" method="post">
                        {% csrf_token %}

                        <p>Hit the "Submit" button at the bottom to save changes</p>
                        
                        <!-- Available -->
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="available" name="available" {% if user.available %}checked{% endif %}>
                            <label class="form-check-label" for="available">Available</label>
                        </div>
                    
                        <p>
                            (Only tutors who are "available" can gain new clients.)
                        </p>
                    
                        <!-- Username (name clients see) -->
                        <div class="mb-3">
                            <label for="username" class="form-label">Username (name clients see)</label>
                            <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" required>
                        </div>
                        
                        <!-- Email -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email*</label>
                            <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                        </div>
                        
                        <!-- Home Address -->
                        <div class="mb-3">
                            <label for="address" class="form-label">Home Address*</label>
                            <input type="text" class="form-control" id="address" name="address" value="{{ user.address }}" required>
                        </div>
                    
                        <!-- Mobile Number -->
                        <div class="mb-3">
                            <label for="mobile" class="form-label">Mobile</label>
                            <input type="tel" class="form-control" id="mobile" name="mobile" pattern="[0-9]{10}" placeholder="e.g., 0455555555" value="{{ user.mobile }}" required>
                            <small class="form-text text-muted">Please enter your mobile number (10 digits).</small>
                        </div>
                        
                        <!-- ATAR -->
                        <div class="mb-3">
                            <label for="atar" class="form-label">ATAR</label>
                            <input type="number" class="form-control" id="atar" name="atar" step="0.01" value="{{ user.atar }}" required>
                        </div>
                        
                        <!-- Suburb -->
                        <div class="mb-3">
                            <label for="suburb" class="form-label">Suburb</label>
                            <input type="text" class="form-control" id="suburb" name="suburb" value="{{ user.suburb }}" required>
                        </div>
                        
                        <!-- Subjects (Multiselect) -->
                        <div class="form-group">
                            <label>Subjects (check to select multiple)</label>
                            {% for subject in subjects %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="subject_{{ subject.id }}" name="subjects" value="{{ subject.id }}" {% if subject in user.subjects.all %}checked{% endif %}>
                                    <label class="form-check-label" for="subject_{{ subject.id }}">{{ subject.name }}</label>
                                </div>
                            {% endfor %}
                        </div>  
                        
                        <!-- Description -->
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="5" maxlength="1000" required>{{ user.description }}</textarea>
                        </div>
                        
                        <!-- University (Optional) -->
                        <div class="mb-3">
                            <label for="university" class="form-label">University (optional)</label>
                            <input type="text" class="form-control" id="university" name="university" value="{{ user.university }}">
                        </div>
                        
                        <!-- Degree (Optional) -->
                        <div class="mb-3">
                            <label for="degree" class="form-label">Degree (optional)</label>
                            <input type="text" class="form-control" id="degree" name="degree" value="{{ user.degree }}">
                        </div>
                    
                        <p>Home address and contact details will only be revealed to clients that have booked a lesson with you.<p>
                        
                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>                                             
                </div>
                <div class="tab-pane fade" id="list-schedule" role="tabpanel" aria-labelledby="list-schedule-list">
                    <h3>Schedule</h3>
                    {% if user.available %}
                        You are listed as <strong>available</strong>.
                    {% else %}
                        You are listed as <strong>unavailable</strong>.
                    {% endif %}
                    <form action="{% url 'dashboard' %}" method="post">
                        <div class="timetable">
                            {% csrf_token %}
                        
                            <div class="column">
                                <h6 class="day-header">Mon</h6>
                                {% for time in times %}
                                    {% if time in user.availability.monday_times.all %}
                                        <input type="checkbox" class="timeslot" name="monday-{{ time }}" checked>
                                    {% else %}
                                        <input type="checkbox" class="timeslot" name="monday-{{ time }}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        
                            <div class="column">
                                <h6 class="day-header">Tue</h6>
                                {% for time in times %}
                                    {% if time in user.availability.tuesday_times.all %}
                                        <input type="checkbox" class="timeslot" name="tuesday-{{ time }}" checked>
                                    {% else %}
                                        <input type="checkbox" class="timeslot" name="tuesday-{{ time }}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        
                            <div class="column">
                                <h6 class="day-header">Wed</h6>
                                {% for time in times %}
                                    {% if time in user.availability.wednesday_times.all %}
                                        <input type="checkbox" class="timeslot" name="wednesday-{{ time }}" checked>
                                    {% else %}
                                        <input type="checkbox" class="timeslot" name="wednesday-{{ time }}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        
                            <div class="column">
                                <h6 class="day-header">Thu</h6>
                                {% for time in times %}
                                    {% if time in user.availability.thursday_times.all %}
                                        <input type="checkbox" class="timeslot" name="thursday-{{ time }}" checked>
                                    {% else %}
                                        <input type="checkbox" class="timeslot" name="thursday-{{ time }}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        
                            <div class="column">
                                <h6 class="day-header">Fri</h6>
                                {% for time in times %}
                                    {% if time in user.availability.friday_times.all %}
                                        <input type="checkbox" class="timeslot" name="friday-{{ time }}" checked>
                                    {% else %}
                                        <input type="checkbox" class="timeslot" name="friday-{{ time }}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        
                            <div class="column">
                                <h6 class="day-header">Sat</h6>
                                {% for time in times %}
                                    {% if time in user.availability.saturday_times.all %}
                                        <input type="checkbox" class="timeslot" name="saturday-{{ time }}" checked>
                                    {% else %}
                                        <input type="checkbox" class="timeslot" name="saturday-{{ time }}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        
                            <div class="column">
                                <h6 class="day-header">Sun</h6>
                                {% for time in times %}
                                    {% if time in user.availability.sunday_times.all %}
                                        <input type="checkbox" class="timeslot" name="sunday-{{ time }}" checked>
                                    {% else %}
                                        <input type="checkbox" class="timeslot" name="sunday-{{ time }}">
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>                        
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
                <div class="tab-pane fade" id="list-log" role="tabpanel" aria-labelledby="list-log-list">
                    <h3>Lesson Log</h3>
                </div>
                <div class="tab-pane fade" id="list-settings" role="tabpanel" aria-labelledby="list-settings-list">
                    <h3>Settings</h3>
                </div>
              </div>
            </div>
          </div>
    </section>
{% endblock %}

{% block script %}
   <script src="{% static 'Narwhal_Tutoring/dashboard.js' %}"></script>
{% endblock %}